
<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="shortcut icon" href="../../assets/images/favicon.png">
      
      <meta name="generator" content="mkdocs-0.16.3, mkdocs-material-1.6.4">
    
    
      
        <title>Configuración inicial - Geoladris</title>
      
    
    
      <script src="../../assets/javascripts/modernizr-1df76c4e58.js"></script>
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application-e2807e330f.css">
      
    
    
      
        
        
        
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
    
  </head>
  
  
  
  
    <body>
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <a href="../.." title="Geoladris" class="md-icon md-icon--home md-header-nav__button">
          </a>
        
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <span class="md-flex__ellipsis md-header-nav__title">
          
            
              
                <span class="md-header-nav__parent">
                  Configuración
                </span>
              
            
            Configuración inicial
          
        </span>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
          
<div class="md-search" data-md-component="search">
  <label class="md-search__overlay" for="search"></label>
  <div class="md-search__inner">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" required placeholder="Search" accesskey="s" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query">
      <label class="md-icon md-search__icon" for="search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset">close</button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta" data-md-lang-result-none="No matching documents" data-md-lang-result-one="1 matching document" data-md-lang-result-other="# matching documents">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <div class="md-header-nav__source">
          
        </div>
      </div>
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    
      <i class="md-icon md-icon--home md-nav__button"></i>
    
    Geoladris
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Introducción
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Introducción
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../user_intro/user_intro/" title="Introducción" class="md-nav__link">
      Introducción
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../user_intro/getting_involved/" title="Participación" class="md-nav__link">
      Participación
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../user_intro/license/" title="Licencia" class="md-nav__link">
      Licencia
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Instalación
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Instalación
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../installation/installation/" title="Instalación" class="md-nav__link">
      Instalación
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../installation/project_structure/" title="Estructura del Proyecto" class="md-nav__link">
      Estructura del Proyecto
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../installation/download/" title="Descargas" class="md-nav__link">
      Descargas
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4" checked>
    
    <label class="md-nav__link" for="nav-4">
      Configuración
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Configuración
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        Configuración inicial
      </label>
    
    <a href="./" title="Configuración inicial" class="md-nav__link md-nav__link--active">
      Configuración inicial
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#directorio-de-configuracion" title="Directorio de configuración" class="md-nav__link">
    Directorio de configuración
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#portalproperties" title="portal.properties" class="md-nav__link">
    portal.properties
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#portalproperties_1" title="portal.properties" class="md-nav__link">
    portal.properties
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#layersjson" title="layers.json" class="md-nav__link">
    layers.json
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adaptacion-del-aspecto-grafico" title="Adaptación del aspecto gráfico" class="md-nav__link">
    Adaptación del aspecto gráfico
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cabecera-de-pagina" title="Cabecera de página" class="md-nav__link">
    Cabecera de página
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#favicon" title="Favicon" class="md-nav__link">
    Favicon
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#estilos-predefinidos-css" title="Estilos predefinidos (CSS)" class="md-nav__link">
    Estilos predefinidos (CSS)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#soporte-multiidioma" title="Soporte multiidioma" class="md-nav__link">
    Soporte multiidioma
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuracion-de-una-nueva-capa" title="Configuración de una nueva capa" class="md-nav__link">
    Configuración de una nueva capa
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conexion-wms" title="Conexión WMS" class="md-nav__link">
    Conexión WMS
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#capas-del-portal" title="Capas del portal" class="md-nav__link">
    Capas del portal
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#grupos" title="Grupos" class="md-nav__link">
    Grupos
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuracion-de-un-nuevo-grupo-de-capas" title="Configuración de un nuevo grupo de capas" class="md-nav__link">
    Configuración de un nuevo grupo de capas
  </a>
  
</li>
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../plugins/" title="Plugins" class="md-nav__link">
      Plugins
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../migrating/" title="Migración de Versiones" class="md-nav__link">
      Migración de Versiones
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../user_deploy/" title="Usuario - Despliegue" class="md-nav__link">
      Usuario - Despliegue
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../user_guides/" title="Usuario - Tutoriales y guías" class="md-nav__link">
      Usuario - Tutoriales y guías
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../dev_plugins/" title="Desarrollador - Plugins" class="md-nav__link">
      Desarrollador - Plugins
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../dev_contrib/" title="Desarrollador - Contribuir" class="md-nav__link">
      Desarrollador - Contribuir
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../dev_tips/" title="Desarrollador - Consejos" class="md-nav__link">
      Desarrollador - Consejos
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../changelog/" title="Changelog" class="md-nav__link">
      Changelog
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#directorio-de-configuracion" title="Directorio de configuración" class="md-nav__link">
    Directorio de configuración
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#portalproperties" title="portal.properties" class="md-nav__link">
    portal.properties
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#portalproperties_1" title="portal.properties" class="md-nav__link">
    portal.properties
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#layersjson" title="layers.json" class="md-nav__link">
    layers.json
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adaptacion-del-aspecto-grafico" title="Adaptación del aspecto gráfico" class="md-nav__link">
    Adaptación del aspecto gráfico
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cabecera-de-pagina" title="Cabecera de página" class="md-nav__link">
    Cabecera de página
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#favicon" title="Favicon" class="md-nav__link">
    Favicon
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#estilos-predefinidos-css" title="Estilos predefinidos (CSS)" class="md-nav__link">
    Estilos predefinidos (CSS)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#soporte-multiidioma" title="Soporte multiidioma" class="md-nav__link">
    Soporte multiidioma
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuracion-de-una-nueva-capa" title="Configuración de una nueva capa" class="md-nav__link">
    Configuración de una nueva capa
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conexion-wms" title="Conexión WMS" class="md-nav__link">
    Conexión WMS
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#capas-del-portal" title="Capas del portal" class="md-nav__link">
    Capas del portal
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#grupos" title="Grupos" class="md-nav__link">
    Grupos
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuracion-de-un-nuevo-grupo-de-capas" title="Configuración de un nuevo grupo de capas" class="md-nav__link">
    Configuración de un nuevo grupo de capas
  </a>
  
</li>
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="configuracion-inicial">Configuración inicial</h1>
<table>
<thead>
<tr>
<th>Fecha</th>
<th>Autores</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>1 Noviembre 2012</td>
<td>Stefano Giaccio (Stefano.Giaccio@fao.org)</td>
<td></td>
</tr>
<tr>
<td>1 Diciembre 2012</td>
<td>Oscar Fonts (oscar.fonts@geomati.co)</td>
<td></td>
</tr>
<tr>
<td>24 Junio 2013</td>
<td>Fernando González (fernando.gonzalez@fao.org)</td>
<td></td>
</tr>
<tr>
<td>18 Mayo 2017</td>
<td>Micho García (micho.garcia@geomati.co)</td>
<td></td>
</tr>
</tbody>
</table>
<pre><code>©2013 FAO Forestry

Excepto donde quede reflejado de otra manera, la presente documentación se halla bajo licencia : Creative Commons (Creative Commons - Attribution - Share Alike: http://creativecommons.org/licenses/by-sa/3.0/deed.es)
</code></pre>
<p>El Portal de NFMS es la aplicación pública de la plataforma, utilizada para la visualización de los recursos cartográficos y estadísticos.</p>
<p>El portal es personalizable a las necesidades de cada país, tanto en su aspecto como en los datos mostrados. La aplicación viene con una configuración por defecto que puede usarse como punto de partida.</p>
<p>En nuestro caso, una vez instalado el portal se obtendrá el siguiente aspecto inicial:</p>
<p><img alt="" src="../../_images/portal_initial_config.png" /></p>
<p>El Portal es accesible en:</p>
<p>http://localhost:8080/portal/</p>
<h2 id="directorio-de-configuracion">Directorio de configuración</h2>
<p>Las aplicaciones Geoladris se pueden configurar utilizando un directorio de configuración. Este directorio se puede especificar de diferentes maneras:</p>
<ul>
<li>Variable de entorno: <code>export GEOLADRIS_CONFIG_DIR=/var/geoladris</code>.</li>
<li>Propiedad Java: <code>-DGEOLADRIS_CONF_DIR=/var/geoladris</code>.</li>
<li>Parámetro en <code>web.xml</code>:</li>
</ul>
<p><code>xml
    &lt;context-param&gt;
        &lt;param-name&gt;GEOLADRIS_CONFIG_DIR&lt;/param-name&gt;
        &lt;param-value&gt;/var/geoladris&lt;/param-value&gt;
    &lt;/context-param&gt;</code></p>
<p>Este directorio deberá contener un subdirectorio por cada aplicación <code>.war</code> desplegada.</p>
<p>Por ejemplo, si se han desplegado los paquetes <code>visor-demo.war</code> y <code>visor-bosques.war</code>, y <code>GEOLADRIS_CONFIG_DIR</code> se ha establecido a <code>var/geoladris</code>, se utilizarán los siguientes directorios de configuración: <code>/var/geoladris/visor-demo</code> y <code>/var/geoladris/visor-bosques</code>.</p>
<p>Si alguno de esos directorios no existe o si <code>GEOLADRIS_CONFIG_DIR</code> no se ha configurado correctamente, se utilizará el directorio por defecto para esa aplicación concreta: <code>&lt;directorio_despliegue_app&gt;/WEB-INF/default_config</code>. Por ejemplo, si se ha desplegado el paquete <code>visor-demo.war</code> en <code>/var/lib/tomcat/webapps</code>, el directorio de configuración del visor sería <code>var/lib/tomcat/webapps/visor-demo/WEB-INF/default_config</code>.</p>
<blockquote>
<p>TODO: Plugins can store configuration in two files:</p>
</blockquote>
<h2 id="portalproperties">portal.properties</h2>
<blockquote>
<p>TODO: Private configuration.</p>
</blockquote>
<p>Únicamente estas propiedades son visibles para el cliente:</p>
<ul>
<li><code>title</code>: Para el <em>tag</em> <code>&lt;title&gt;</code> del fichero HTML. Si el título no se especifica aquí, se obtiene de los ficheros <code>messages.properties</code>.</li>
</ul>
<blockquote>
<p>TODO: Good for passwords and sensitive information</p>
</blockquote>
<p>El directorio de configuración tiene la siguiente estructura:</p>
<pre><code>  /var/portal
  |- indicators/
  |- portal.properties
  |- layers.json
  |- public-conf.json
  |- messages/
   \- static/
        |- overrides.css
        |- img/
        \- loc/
            |- en/
            │   |- documents/
            │   |- html/
            │   \- images/
            \- es
                |- documents/
                |- html/
                \- images/
</code></pre>
<p>Los ficheros principales son:</p>
<ul>
<li><code>portal.properties</code>, contiene parámetros generales del portal, como por ejemplo los idiomas soportados.</li>
<li><code>layers.json</code>, probablemente el fichero más importante, contiene la configuración de las capas de datos a mostrar.</li>
<li><code>messages/</code> contiene los textos de la aplicación traducidos a varios idiomas.</li>
<li><code>indicators/</code>.</li>
<li><code>static/</code> contiene recursos estáticos.</li>
<li><code>static/loc</code>: recursos clasificados por idioma</li>
<li><code>static/overrides.css</code>: última hoja CSS cargada, ideal para sobreescribir otros estilos</li>
</ul>
<h3 id="portalproperties_1">portal.properties</h3>
<table>
<thead>
<tr>
<th>Propiedad</th>
<th>Valor</th>
<th>Descripción</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>languages</td>
<td>{"en": "English", "fr": "Fran\u00e7ais", "es": "Espa\u00f1ol"}</td>
<td>Elemento JSON con los idiomas que soporta la aplicación</td>
<td></td>
</tr>
<tr>
<td>languages.default</td>
<td>en</td>
<td>Idioma por defecto.</td>
<td></td>
</tr>
<tr>
<td>db-schema</td>
<td>portal_redd</td>
<td>Nombre del esquema donde están las tablas necesarias para las distintas funcionalidades como estadísticas y feedback</td>
<td></td>
</tr>
<tr>
<td>map.centerLonLat</td>
<td>-58,-34</td>
<td>Longitud y latitud del centro inicial del mapa</td>
<td></td>
</tr>
<tr>
<td>map.initialZoomLevel</td>
<td>5</td>
<td>Zoom inicial</td>
<td></td>
</tr>
</tbody>
</table>
<h3 id="layersjson">layers.json</h3>
<p>Define la estructura de capas del proyecto. Consiste en un elemento JSON con cuatro propiedades::</p>
<pre><code>{
    "default-server" : "http://snmb.ambiente.gob.ar/",
    "wmsLayers" : [],
    "portalLayers" : [],
    "groups" : []
}
</code></pre>
<ul>
<li>
<p><code>default-server</code> define el servidor que se usará como base en caso de que la URL de las capas no incluyan servidor. Ver atributo <code>baseUrl</code> más abajo.</p>
</li>
<li>
<p><code>wmsLayers</code> define las capas WMS que tendrá el mapa. El orden en el que estas capas aparecen en el array <code>wmsLayers</code> define el orden de las capas en el dibujado del mapa. Cada capa consistirá en un elemento que puede ser de tres tipos. El tipo por defecto es WMS y tiene las siguientes propiedades:</p>
<ul>
<li>id: Identificado de la capa</li>
<li>type: Tipo de la capa: WMS, Open Street Map, Google maps, respectivamente "wms", "osm" o "gmaps". Por defecto se tomará type:"wms"</li>
<li>visible: Si la capa es utilizada para visualizarse en el mapa o sólo para otras cosas (petición de información, por ejemplo).</li>
<li>zIndex: Posición en la pila de dibujado</li>
<li>legend: Nombre del fichero imagen con la leyenda de la capa. Estos ficheros se acceden en static/loc/{lang}/images. También es posible poner la cadena de carácteres "auto" y el portal intentará obtener la imagen automáticamente de GeoServer usando la petición GetLegendGraphics de WMS.</li>
<li>label: Título de la leyenda</li>
<li>sourceLink: URL del proveedor de los datos</li>
<li>sourceLabel: Texto con el que presentar el enlace especificado en sourceLink</li>
</ul>
<p>En función del tipo de la capa se especificarán además otras propiedades</p>
</li>
<li>
<p><strong>WMS</strong>:</p>
<ul>
<li>baseUrl: URL del servidor WMS que sirve la capa. Si se especifica una URL sin servidor, por ejemplo "/diss_geoserver/gwc/service/wms", se usará <code>default-server</code>.</li>
<li>wmsName: Nombre de la capa en el servicio WMS</li>
<li>imageFormat: Formato de imagen a utilizar en las llamadas WMS</li>
<li>queryType: Protocolo usado para la herramienta de información: "wfs" o "wms". En caso de ser "wfs" los siguientes parámetros son obligatorios: <em>queryUrl</em>, <em>querGeomFieldName</em>, <em>queryFieldNames</em>, <em>queryFieldAliases</em>, <em>queryTimeField</em> (en caso de ser una capa temporal). En caso de ser "wms" no hay ningún parámetro adicional obligatorio, por lo que una capa que quiera usar WMS para la herramienta de información puede configurarse sólo con: <code>"queryType":"wms"</code>. El único requisito para capas con <code>"queryType":"wms"</code> es que el servidor codifique en EPSG:4326 la geometría de la respuesta al GetFeatureInfo, en caso contrario el objeto consultado no se podrá localizar en el mapa mediante zoom y resaltado. Si la capa no tiene un parámetro <code>queryType</code> la capa no será consultable.</li>
<li>queryUrl: URL base a utilizar en la petición de información. Base del servidor WMS o WFS a utilizar (según <code>queryType</code>). Si no se especifica se toma <code>baseUrl</code>.</li>
<li>queryGeomFieldName: Obligatorio en el caso de <code>"queryType":"wfs"</code>. El nombre del campo geométrico. Típicamente "geom", "the_geom", "geometry", etc.</li>
<li>queryFieldNames: Obligatorio en el caso de <code>"queryType":"wfs"</code>. Nombres de los campos que se quieren obtener en la petición de info.</li>
<li>queryFieldAliases: Obligatorio en el caso de especificar <code>queryFieldNames</code>. Aliases de los campos especificados en <code>queryFieldNames</code>.</li>
<li>queryTimeFieldName: Obligatorio en el caso de <code>"queryType":"wfs"</code> si la capa tiene varias instancias temporales. Sin uso en el caso de <code>"queryType":"wms"</code>.</li>
<li>queryHighlightBounds: Sólo para el caso <code>"queryType":"wms"</code>. Si se desea resaltar solo el rectángulo que encuadra la geometría de los objetos consultados (<code>true</code>) o toda la geometría (<code>false</code>). Por defecto es <code>false</code>. En los casos en los que la geometría es muy grande puede ser conveniente ponerlo a <code>true</code> para que el proceso de resaltado sea más rápido.</li>
</ul>
<p>Por ejemplo:</p>
</li>
</ul>
<pre><code>
        {
            &quot;wmsLayers&quot; : [
                {
                    &quot;id&quot; : &quot;provinces&quot;,
                    &quot;baseUrl&quot; : &quot;http://snmb.ambiente.gob.ar/geo-server/bosques_umsef_db/wms&quot;,
                    &quot;wmsName&quot; : &quot;bosques_umsef_db:limites_provinciales&quot;,
                    &quot;imageFormat&quot; : &quot;image/png8&quot;,
                    &quot;visible&quot; : true,
                    &quot;sourceLink&quot; : &quot;&quot;,
                    &quot;sourceLabel&quot; : &quot;&quot;,
                    &quot;queryable&quot; : true
                }
            ],
            ...
        }
</code></pre>

<ul>
<li>
<p><strong>OpenStreetMap</strong>:</p>
<ul>
<li>osmUrls: lista de las URL de los tiles. Usando ${x}, ${y} y ${z} como variables.</li>
</ul>
<p>Por ejemplo:</p>
</li>
</ul>
<pre><code>
        {
            &quot;wmsLayers&quot; : [
                {
                    &quot;id&quot; : &quot;openstreetmap&quot;,
                    &quot;type&quot; : &quot;osm&quot;,
                    &quot;osmUrls&quot; : [
                        &quot;http://a.tile.openstreetmap.org/${z}/${x}/${y}.png&quot;,
                        &quot;http://b.tile.openstreetmap.org/${z}/${x}/${y}.png&quot;,
                        &quot;http://c.tile.openstreetmap.org/${z}/${x}/${y}.png&quot;
                    ]
                }           
            ],
            ...
        }
</code></pre>

<ul>
<li>
<p><strong>Google</strong>:</p>
<ul>
<li>gmaps-type: Tipo de capa Google: ROADMAP, SATELLITE, HYBRID o TERRAIN</li>
</ul>
<p>Por ejemplo:</p>
</li>
</ul>
<pre><code>
        {
            &quot;wmsLayers&quot; : [
                {
                    &quot;id&quot; : &quot;google-maps&quot;,
                    &quot;type&quot; : &quot;gmaps&quot;,
                    &quot;gmaps-type&quot; : &quot;SATELLITE&quot;
                }
            ],
            ...
        }
</code></pre>

<ul>
<li>
<p><code>portalLayers</code> define las capas que aparecen visibles al usuario. Una <code>portalLayer</code> puede contener varias <code>wmsLayers</code>. Cada <code>portalLayer</code> puede contener los siguientes elementos:</p>
<ul>
<li>id: id de la capa</li>
<li>label: Texto con el nombre de la capa a usar en el portal. Si se especifica entre ${ }, se intentará obtener la traducción de los ficheros .properties existentes en el directorio <code>messages</code> del  directorio de configuración del portal.</li>
<li>infoFile: Nombre del fichero HTML con información sobre la capa. El fichero se accede en static/loc/{lang}/html. En la interfaz gráfica se representa con un botón de información al lado del nombre de la capa</li>
<li>infoLink: Url con la información sobre la capa. Igual que infoFile pero especificando una ruta absoluta. infoFile tiene preferencia sobre infoLink, por lo que si se define el primero, infoLink se ignorará.</li>
<li>inlineLegendUrl: URL con una imagen pequeña que situar al lado del nombre de la capa en el árbol de capas. También es posible poner la cadena de carácteres "auto" y el portal intentará obtener la imagen automáticamente de GeoServer usando la petición GetLegendGraphics de WMS.</li>
<li>active: Si la capa está inicialmente visible o no</li>
<li>layers: Array con los identificadores de las <code>wmsLayers</code> a las que se accede a través de esta capa</li>
<li>timeInstances: Instantes de tiempo en ISO8601 separados por comas</li>
<li>timeStyles: Nombres de los estilos a utilizar para cada instancia temporal. Cada estilo se corresponde con aquella instancia temporal que ocupa la misma posición en la lista. Si no se especifica este parámetro se utilizará el estilo por defecto para todos los estilos.</li>
<li>date-format: Formato de la fecha para cada capa. Según la librería Moment (http://momentjs.com/docs/#/displaying/). Por ejempo: "DD-MM-YYYY". Por defecto sólo el año (YYYY).</li>
<li>feedback: En el caso de que la herramienta de feedback esté instalada, si se quiere o no que la capa aparezca en dicha herramienta para permitir al usuario hacer comentarios sobre la capa.  </li>
</ul>
<p>Por ejemplo::</p>
<pre><code>{
    "wmsLayers" : [
        {
            "id" : "provinces",
            "baseUrl" : "http://snmb.ambiente.gob.ar/geo-server/bosques_umsef_db/wms",
            "wmsName" : "bosques_umsef_db:limites_provinciales",
            "imageFormat" : "image/png8",
            "visible" : true,
            "sourceLink" : "",
            "sourceLabel" : "",
            "queryable" : true
        }
    ],
    "portalLayers" : [
        {
            "id" : "provinces",
            "active" : true,
            "infoFile" : "provinces_def.html",
            "label" : "${provinces}",
            "layers" : [ "wms_provinces" ],
            "inlineLegendUrl" : "http://snmb.ambiente.gob.ar/geo-server/bosques_umsef_db/wms?REQUEST=GetLegendGraphic&amp;VERSION=1.0.0&amp;FORMAT=image/png&amp;WIDTH=20&amp;HEIGHT=20&amp;LAYER=bosques_umsef_db:limites_provinciales&amp;TRANSPARENT=true",
            "timeInstances" : "",
            "timeStyles" : "",
            "date-format" : ""
        }
    ],
    ...
}
</code></pre>
</li>
<li>
<p><code>groups</code> define la estructura final de las capas en el árbol de capas de la aplicación. Cada elemento de <code>groups</code> contiene:</p>
<ul>
<li>id: id del grupo</li>
<li>label: Igual que en <code>portalLayer</code></li>
<li>infoFile: Igual que en <code>portalLayer</code></li>
<li>infoLink: Igual que en <code>portalLayer</code></li>
<li>items. Array de otros grupos, con la misma estructura que este elemento (recursivo).</li>
</ul>
<p>Por ejemplo::</p>
<pre><code>{
    "wmsLayers" : [
        {
            "id" : "provinces",
            "baseUrl" : "http://snmb.ambiente.gob.ar/geo-server/bosques_umsef_db/wms",
            "wmsName" : "bosques_umsef_db:limites_provinciales",
            "imageFormat" : "image/png8",
            "visible" : true,
            "sourceLink" : "",
            "sourceLabel" : "",
            "queryable" : true
        }
    ],
    "portalLayers" : [
        {
            "id" : "provinces",
            "active" : true,
            "infoFile" : "provinces_def.html",
            "label" : "${provinces}",
            "layers" : [ "wms_provinces" ],
            "inlineLegendUrl" : "http://snmb.ambiente.gob.ar/geo-server/bosques_umsef_db/wms?REQUEST=GetLegendGraphic&amp;VERSION=1.0.0&amp;FORMAT=image/png&amp;WIDTH=20&amp;HEIGHT=20&amp;LAYER=bosques_umsef_db:limites_provinciales&amp;TRANSPARENT=true",
            "timeInstances" : "",
            "timeStyles" : "",
            "date-format" : ""
        }
    ],
    "groups" : [
        {
            "id" : "base",
            "label" : "${base_layers}",
            "infoFile": "base_layers.html",
            "items" : ["provinces"]
        }
    ]
}
</code></pre>
</li>
</ul>
<h2 id="adaptacion-del-aspecto-grafico">Adaptación del aspecto gráfico</h2>
<h3 id="cabecera-de-pagina">Cabecera de página</h3>
<p>Veamos cómo modificar la imagen de fondo, bandera y título de la cabecera del portal:</p>
<p><img alt="" src="../../_images/header.png" /></p>
<p>Partiendo del PORTAL_CONFIG_DIR (generalmente en /var/portal):</p>
<ul>
<li>
<p><strong>Imagen de fondo</strong>: Se encuentra en <code>static/img/right.jpg</code>. Sustituir este fichero por otro de igual nombre y formato (jpeg), de 92 píxeles de alto. El ancho puede variar, aunque se recomienda que sea tan ancho como sea posible, hasta los 1920 px de una pantalla de alta definición. Para conseguir un mejor efecto junto con la bandera, se recomienda rellenar de contenido (logotipos, fotografía) la parte más a la derecha de la imagen, hasta un máximo de 500 px. Utilizar un color de fondo liso para el resto de la imagen, que ocupe toda la franja de la izquierda, y que se corresponda con el color de fondo de la bandera.</p>
</li>
<li>
<p><strong>Bandera</strong>: Se encuentra en <code>static/img/left.jpg</code>. Sustituir este fichero por otro de igual nombre y formato (jpeg), de 92 píxeles de alto. El ancho puede variar, aunque se recomienda alrededor de los 200 px. Utilizar un color de fondo liso, correspondiente con la parte izquierda de la imagen de fondo, para dar una sensación de continuidad.</p>
</li>
<li>
<p><strong>Título</strong>: Se encuentra definido en los ficheros de mensajes, directorio <code>messages</code>, ficheros de nombre <code>messages_&lt;lang&gt;.properties</code>. Buscar la propiedad "title" en cada uno de los ficheros de idioma.</p>
</li>
</ul>
<h3 id="favicon">Favicon</h3>
<p>Se conoce como <em>favicon</em> al icono que se muestra en el navegador en la barra de direcciones. Para personalizar el <em>favicon</em>
del portal, basta con copiar la imagen en el directorio <code>static/img</code>. El nombre de la imagen sólo puede ser <code>favicon.ico</code> o <code>favicon.png</code>.</p>
<h3 id="estilos-predefinidos-css">Estilos predefinidos (CSS)</h3>
<p>En ciertos casos se requiere modificar los estilos que vienen predefinidos para OpenLayers, jQuery o cualquier otro. En estos casos,
en lugar de modificar los estilos directamente en el fichero que se encuentra en <code>/var/tomcat/webapps/portal</code>, se ha de crear
un nuevo fichero <code>overrides.css</code> en el directorio <code>/var/portal/static/css</code> que contenga las reglas CSS que se desean modificar.</p>
<p>De esta manera, tendrán preferencia las reglas que se escriban en <code>overrides.css</code> frente a cualquier otra que se encuentre en
<code>/var/tomcat/webapps/portal</code>.</p>
<p>Además, cuando se despliegue una actualización del portal en Tomcat, el fichero <code>overrides.css</code> no se modificará, manteniendo
así la personalización.</p>
<h2 id="soporte-multiidioma">Soporte multiidioma</h2>
<p>En los casos anteriores vemos algunas cadenas de texto entre los símbolos <code>${</code> y <code>}</code>. Estos elementos son sustituidos por mensajes de texto traducidos a cada idioma.</p>
<p>En el directorio <code>messages</code> contamos con un fichero <code>messages.properties</code> que contiene los mensajes por defecto. Son los textos que se usarán en caso de no encontrar mensajes traducidos a una lengua específica. Los ficheros para los distintos idiomas soportados llevan el código del idioma al final del nombre, según la <code>[nomenclatura ISO 639-1 de dos letras](http://en.wikipedia.org/wiki/List_of_ISO_639-1_codes)</code></p>
<p>Para añadir un nuevo idioma (por ejemplo, el guaraní):</p>
<ul>
<li>
<p>Editar <code>portal.properties</code> y añadir el elemento <code>"gn": "Guaraní"</code> a la propiedad <code>languages</code>::</p>
<p>languages = {"gn": "Guaraní", "es": "Español", "en": "English"}</p>
</li>
<li>
<p>Copiar el fichero <code>messages_es.properties</code> con el nuevo nombre <code>messages_gn.properties</code>.</p>
</li>
<li>Traducir los textos en <code>messages_gn.properties</code>.</li>
<li>Reiniciar la aplicación para aplicar los cambios. Desde la linea de comandos::</li>
</ul>
<pre><code>    $ sudo service tomcat6 restart
</code></pre>

<h2 id="configuracion-de-una-nueva-capa">Configuración de una nueva capa</h2>
<p>La definición de las capas a mostrar en el Portal se encuentra en el fichero <code>layers.json</code>.</p>
<p>Contiene la información para asociar los elementos de la interfaz de usuario (panel con la lista de capas en la parte izquierda de la página)
con las capas WMS publicadas en GeoServer, personalizar las leyendas, y definir cuáles de las capas son interrogables. También clasifica las capas
por grupos.</p>
<p>El formato utilizado para este fichero de configuración es JSON (JavaScript Object Notation), que es un formato para la representación de datos. Está fuera del objetivo de esta guía el aprendizaje de JSON, pero se exponen a continuación algunas nociones básicas:</p>
<ul>
<li>
<p>Los valores en JSON pueden ser: números, cadenas de carácteres, booleanos, arrays, objetos y el valor nulo. Por ejemplo: 13, "hola mundo", true, [12, 5, 2], {"id":3}.</p>
</li>
<li>
<p>Los objetos están delimitados por llaves (<code>{}</code>) y contienen una serie de pares atributo-valor separados por comas. Los pares atributo/valor consisten en un nombre de propiedad entrecomillado, dos puntos y el valor. Por ejemplo podemos tener el siguiente elemento:</p>
</li>
</ul>
<pre><code>
    {
        &quot;id&quot;:12,
        &quot;nombre&quot;:&quot;paco&quot;,
        &quot;edad&quot;:55
    }

  o incluso un elemento dentro de otro:

</code></pre>

<pre><code>{
    "empresa":"zapatos smith",
    "propietario":{
        "id":12,
        "nombre":"john smith",
        "edad":55
    },
    "pais":"Argentina"
}
</code></pre>
<ul>
<li>Los arrays especifican sus valores entre corchetes ([]) y separados por comas.</li>
</ul>
<pre><code>
    [1, 2, 3, 4, 5]

    [
        {
            &quot;id&quot;:12,
            &quot;nombre&quot;:&quot;john smith&quot;,
            &quot;edad&quot;:34
        },
        {
            &quot;id&quot;:12,
            &quot;nombre&quot;:&quot;sarah smith&quot;,
            &quot;edad&quot;:22
        },
        {
            &quot;id&quot;:12,
            &quot;nombre&quot;:&quot;Clark Kent&quot;,
            &quot;edad&quot;:43
        }
    ]
</code></pre>

<aside class="notice">

  * `Introducción al formato JSON <http://www.json.org/>`_
  * `Validador de JSON <http://jsonformatter.curiousconcept.com/>`_
  * Validador en línea de comandos: python -mjson.tool <fichero.json>

</aside>

<p>El fichero <code>layers.json</code> contiene tres secciones:</p>
<ul>
<li><code>wmsLayers</code></li>
<li><code>portalLayers</code></li>
<li><code>groups</code></li>
</ul>
<p>En este apartado vamos a realizar dos ejercicios:</p>
<ul>
<li>
<p>En primer lugar, vamos a añadir la capa de límites administrativos al grupo existente de "admin_areas".</p>
</li>
<li>
<p>En segundo lugar, añadiremos la capa "roads" en un nuevo grupo de capas.</p>
</li>
</ul>
<h2 id="conexion-wms">Conexión WMS</h2>
<p>Cada "wmsLayer" se corresponde con una de las capas publicadas en GeoServer, y describe la manera de conectarse al servidor para obtener los datos:</p>
<p>TODO link the reference and complete the reference if necessary</p>
<pre><code>
  &quot;wmsLayers&quot;: [
     {
      &quot;id&quot;: &quot;limites_administrativos&quot;,
      &quot;baseUrl&quot;: &quot;http://172.16.250.131/geoserver/gwc/service/wms&quot;,
      &quot;wmsName&quot;: &quot;capacitacion:limites_administrativos&quot;,
      &quot;imageFormat&quot;: &quot;image/png&quot;,
      &quot;visible&quot;: true
    }
  ],

</code></pre>

<ul>
<li>Es posible copiar y pegar un elemento existente y reemplazar :</li>
<li>el nuevo "id" será distinto a todos los otros, por ejemplo: "limites_administrativos".</li>
<li>el nuevo "wmsName" será "capacitacion:limites_administrativos" (el nombre de la capa publicada en GeoServer).</li>
<li>la baseUrl debe apuntar al servidor geoserver donde hemos cargado la capa.</li>
</ul>
<h2 id="capas-del-portal">Capas del portal</h2>
<p>Cada "portalLayer" representa una capa en el árbol de capas del portal y por tanto añade nuevos datos necesarios para mostrar la información en la interfaz gráfica.</p>
<pre><code>
  &quot;portalLayers&quot;: [
    {
      &quot;id&quot;: &quot;limites_administrativos&quot;,
      &quot;active&quot;: true,
      &quot;label&quot;: &quot;${limites_administrativos}&quot;,
      &quot;infoFile&quot;: &quot;limites_def.html&quot;,
      &quot;layers&quot;: [&quot;country&quot;],
      &quot;inlineLegendUrl&quot;: &quot;http://172.16.250.131/geoserver/wms?REQUEST=GetLegendGraphic&amp;VERSION=1.0.0&amp;FORMAT=image/png&amp;WIDTH=20&amp;HEIGHT=20&amp;LAYER=unredd:country&amp;TRANSPARENT=true&quot;
    }
  ],

</code></pre>

<ul>
<li>
<p>Añadir un nuevo objeto en "context", de igual estructura y valores que "country", excepto los siguientes cambios:</p>
</li>
<li>
<p>el nuevo "id" será "regions".</p>
</li>
<li>como "label" se utilizará "${limites_administrativos}". De nuevo, esta etiqueta de sintaxis ${...} será sustituida por un texto en el idioma que
    corresponda, según los contenidos de "messages". Es la etiqueta que se mostrará en la interfaz gráfica.</li>
<li>en "infoFile" pondremos "administrative_boundaries_def.html". Esto creará un enlace a un documento con información sobre
    los datos (localizado en :file:<code>static/loc/&lt;idioma&gt;/html/</code>).</li>
<li>en "layers" pondremos ["limites_administrativos"], haciendo referencia al nuevo <em>layer</em>.</li>
<li>en "inlineLegendUrl" estableceremos el parámetro LAYER así <code>LAYER=capacitacion:limites_administrativos</code>. Esto generará
    una imagen con la leyenda.</li>
</ul>
<h2 id="grupos">Grupos</h2>
<p>Los "Groups" son una estructura recursiva (multinivel) para agrupar visualmente las capas en el panel.
El "group" de primer nivel construye cada uno de los grupos de capas en forma de persiana desplegable, conteniendo una lista de
"items" que hacen referencia a los contextos definidos anteriormente.</p>
<pre><code>
    &quot;groups&quot; : [
        {
            &quot;id&quot; : &quot;admin&quot;,
            &quot;label&quot; : &quot;${admin_areas}&quot;,
            &quot;items&quot; : [ &quot;countryBoundaries&quot;, &quot;provinces&quot; ]
        },
        ...
    ]

</code></pre>

<p>Nótese que en la propiedad "items", se hace referencia a las "portalLayers" definidas anteriormente. También, es posible dentro de dicha propiedad, añadir varios subgrupos de manera que las capas contenidas en éstos se visualicen dentro de una misma pestaña, pero agrupados visualmente bajo un título.</p>
<pre><code>
    &quot;groups&quot; : [
        {
            &quot;id&quot; : &quot;admin&quot;,
            &quot;label&quot; : &quot;${admin_areas}&quot;,
            &quot;items&quot; : [
                {
                    &quot;id&quot; : &quot;admin1&quot;,
                    &quot;label&quot; : &quot;Nacional&quot;,
                    &quot;items&quot;: [&quot;limite_nacional&quot;]
                }, {
                    &quot;id&quot; : &quot;admin2&quot;,
                    &quot;label&quot; : &quot;Regional&quot;,
                    &quot;items&quot;: [ &quot;provincias&quot; ]
                }
            ]
        },
        ...
    ]

</code></pre>

<ul>
<li>Añadir un nuevo elemento <code>{ "context": "limites_administrativos" }</code> a continuación de <code>{ "context": "country" }</code>. Esto incluirá la capa
  en el grupo de áreas administrativas.</li>
<li>Finalmente, utilizar un validador JSON, para comprobar que la sintaxis del nuevo :file:<code>layers.json</code> es correcta, y recargar la página.</li>
</ul>
<h2 id="configuracion-de-un-nuevo-grupo-de-capas">Configuración de un nuevo grupo de capas</h2>
<p>Repetiremos el ejercicio anterior para añadir la capa de ciudades, teniendo en cuenta que:</p>
<ul>
<li>
<p>Para el nuevo "layer", usaremos el id "ciudades" y la capa wms "capacitacion:ciudades". Además, añadiremos un nuevo
  atributo <code>"legend": "ciudades.png"</code> para mostrar la leyenda de la capa. Este atributo hace referencia a una imagen
  localizada en :file:<code>static/loc/&lt;idioma&gt;/images/</code>.</p>
</li>
<li>
<p>En el nuevo "context", será más sencillo, sólo contendrá los tres elementos <code>"id": "roads", "label": "${ciudades}", "layers": ["ciudades"]</code>.</p>
</li>
<li>
<p>En "contextGroups", crearemos un nuevo grupo llamado "otros", con esta sintaxis:</p>
</li>
</ul>
<pre><code>
  {
    &quot;group&quot;: {
      &quot;label&quot;: &quot;${other}&quot;,
      &quot;items&quot;: [
          { &quot;context&quot;: &quot;roads&quot; }
      ]
  }

</code></pre>

<ul>
<li>Tras validar el JSON, y recargar la página, obtendremos la capa de carreteras bajo el nuevo grupo "Otros".</li>
</ul>
                
                  
                
              
              
                
              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../../installation/download/" title="Descargas" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Descargas
              </span>
            </div>
          </a>
        
        
          <a href="../plugins/" title="Plugins" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Plugins
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="http://www.mkdocs.org" title="MkDocs">MkDocs</a>
        and
        <a href="http://squidfunk.github.io/mkdocs-material/" title="Material for MkDocs">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application-06a3e72efd.js"></script>
      <script>app.initialize({url:{base:"../.."}})</script>
      
    
    
      
    
  </body>
</html>